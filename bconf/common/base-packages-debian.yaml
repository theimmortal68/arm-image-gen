---
mmdebstrap:
  suite: bookworm
  components:
    - main
    - contrib
    - non-free
    - non-free-firmware
  architectures:
    - arm64
  variant: apt
  format: directory
  packages:
    - ca-certificates
    - curl
    - wget
    - git
    - unzip
    - rsync
    - jq
    - crudini
    - python3
    - python3-venv
    - python3-dev
    - python3-pip
    - build-essential
    - gcc
    - g++
    - make
    - pkg-config
    - libffi-dev
    - libusb-1.0-0-dev
    - libncurses-dev
    - debian-archive-keyring
    - locales
    - tzdata
    - netbase

# Block services from starting in chroot (safe for all later layers)
setup-hook:
  - |
    set -e
    install -d "$1/usr/sbin"
    cat > "$1/usr/sbin/policy-rc.d" <<'EOS'
    #!/bin/sh
    exit 101
    EOS
    chmod +x "$1/usr/sbin/policy-rc.d"

# Make apt a bit more resilient in CI
customize-hook:
  - |
    set -e
    cat > "$1/etc/apt/apt.conf.d/99net-tuning" <<'EOF'
    Acquire::ForceIPv4 "true";
    Acquire::Retries "5";
    Acquire::http::Timeout "30";
    Acquire::https::Timeout "30";
    Acquire::Languages "none";
    EOF
