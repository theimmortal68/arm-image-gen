---
mmdebstrap:
  suite: noble            # or jammy if you prefer 22.04
  components:
    - main
    - restricted
    - universe
    - multiverse
  architectures:
    - arm64
  variant: apt
  format: directory
  # optional: pick a mirror explicitly (helps in CI)
  # mirrors:
  #   - http://archive.ubuntu.com/ubuntu

  packages:
    - ubuntu-keyring
    - ca-certificates
    - curl
    - wget
    - git
    - unzip
    - rsync
    - jq
    - crudini
    - python3
    - python3-venv
    - python3-dev
    - python3-pip
    - build-essential
    - gcc
    - g++
    - make
    - pkg-config
    - libffi-dev
    - libusb-1.0-0-dev
    - libncurses-dev
    - locales
    - tzdata
    - netbase
    - arch-test      # optional: quiets foreign-arch checks inside chroot

  setup-hooks:
    - |
      set -eu
      # block services in chroot
      install -d "$1/usr/sbin"
      printf '#!/bin/sh\nexit 101\n' > "$1/usr/sbin/policy-rc.d"
      chmod +x "$1/usr/sbin/policy-rc.d"

  customize-hooks:
    - |
      set -eu
      # small apt hardening for CI
      install -d "$1/etc/apt/apt.conf.d"
      cat > "$1/etc/apt/apt.conf.d/99net-tuning" <<'EOF'
      Acquire::ForceIPv4 "true";
      Acquire::Retries "5";
      Acquire::http::Timeout "30";
      Acquire::https::Timeout "30";
      EOF
