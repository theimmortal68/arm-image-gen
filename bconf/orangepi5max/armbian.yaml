---
mmdebstrap:
  customize-hooks:
    - |
      set -eu
      install -d "$1/usr/share/keyrings" "$1/etc/apt/sources.list.d"
      # Install Armbian repo key into a dedicated keyring
      curl -fsSL https://apt.armbian.com/armbian.key \
        | gpg --dearmor -o "$1/usr/share/keyrings/armbian.gpg"
      chmod 0644 "$1/usr/share/keyrings/armbian.gpg"

      # Armbian repo on Bookworm (components include main + bookworm-utils + bookworm-desktop)
      cat > "$1/etc/apt/sources.list.d/armbian.list" <<'EOF'
      deb [signed-by=/usr/share/keyrings/armbian.gpg] http://apt.armbian.com bookworm main bookworm-utils bookworm-desktop
      EOF

      # Optional: pull firmware/meta from Armbian
      chroot "$1" bash -euo pipefail <<'EOSH'
      export DEBIAN_FRONTEND=noninteractive
      apt-get update
      apt-get install -y armbian-firmware || true
      EOSH
